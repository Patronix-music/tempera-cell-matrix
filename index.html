<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<title>Tempera Cell Matrix</title>


  <link href="assets/css/app.css?v=2.7.16" rel="stylesheet"/>
  <script defer="" src="assets/js/tcm.js?v=2.7.16"></script>
</head>
<body>
<header>
<div class="wrap">
<div class="topline">
<div>
<div class="titleRow">
<h1 id="appTitle">Tempera Cell Matrix</h1><span class="spec" id="aboutBadge" title="">v</span>
<div class="specInline" id="specLine"></div>
</div>
<div class="sub">
            Click a cell to select it. <span class="kbd">Double‑click</span> or <span class="kbd">▶</span> to play.
            Stop: <span class="kbd">Esc</span>.
            Drag cell→cell: swap (Alt = copy).
          </div>
</div>
<div class="actionsWrap"><div class="actions">
<div class="btnGroupInline"><button class="pop" id="random64Btn" title="Pick a folder (recursive) and randomly fill all 64 cells. Tip: hold Shift to filter which files are used for loading samples.">Random 64 <span aria-hidden="true" class="filterIcon"></span></button>
<button class="warn" id="exportAllBtn">Export all (ZIP)</button>
<button class="secondary" id="importPresetBtn" title="Load preset JSON exported by this app, then relink samples from a folder">Import Preset</button>
<button class="secondary" id="helpBtn" title="Show help / shortcuts">Help</button></div>
<span aria-hidden="true" class="sep"></span>
<label class="tog" title="Tempo mode uses BPM + beats-per-cell to set cell/column lengths. Off = fixed 2^20 points per column.">
<input id="tempoMode" type="checkbox"/>
            Tempo (BPM)
          </label>
<div class="field" title="Beats per minute">
<label for="bpm">BPM</label>
<div class="numCtl">
<button aria-label="BPM minus" class="tiny secondary stepBtn" data-dir="-1" data-for="bpm">−</button>
<input id="bpm" max="400" min="20" step="1" type="number" value="120"/>
<button aria-label="BPM plus" class="tiny secondary stepBtn" data-dir="1" data-for="bpm">+</button>
</div>
</div>
<div class="field" title="How many beats in one cell (slice).">
<label for="beatsPerCell">Beats/cell</label>
<div class="numCtl">
<button aria-label="Beats per cell minus" class="tiny secondary stepBtn" data-dir="-1" data-for="beatsPerCell">−</button>
<input id="beatsPerCell" max="16" min="0.125" step="0.125" type="number" value="1"/>
<button aria-label="Beats per cell plus" class="tiny secondary stepBtn" data-dir="1" data-for="beatsPerCell">+</button>
</div>
</div>
<span aria-hidden="true" class="sep"></span>
<label class="tog" title="For Load+Slice: time-fit (pitch changes) so the full sample exactly fills the column.">
<input id="splitFit" type="checkbox"/>
            Split fit (pitch)
          </label>
<label class="tog" title="Normalize on load (per cell) by setting gain based on peak level.">
<input id="normalizeOnLoad" type="checkbox"/>
            Normalize load
          </label>
<span aria-hidden="true" class="sep"></span>
<div class="field nameTpl" title="Filename template. Placeholders: {col} {colname} {mode} {bpm} {sr} {frames} {date}">
<label for="nameTemplate">Name</label>
<div class="tplWrap">
<input id="nameTemplate" type="text" value="tempera_{mode}_{bpm}bpm_col{col}_{colname}_{date}"/> <button class="tplDropBtn" id="nameTemplateDropBtn" title="Recent templates" type="button">▾</button>
</div>
<div aria-label="Recent templates" class="tplDropMenu" id="nameTemplateDropMenu" role="listbox"></div>
</div>
</div>
</div>
</div>
<div class="copyrightTop"><span id="copyrightText"></span><div class="miniRow"><button class="good audioMini" id="enableAudioBtn" title="Required on some browsers before audio playback">Enable audio</button><button class="secondary audioMini" id="stopBtn">Stop</button><button class="danger audioMini" id="clearAllBtn">Clear all</button></div></div>
</div></header>
<main>
<div class="layout">
<div class="cols" id="cols"></div>
<div class="inspector" id="inspector">
<div class="inspHead">
<div class="inspTitle">
<div class="t" id="inspTitle">Cell settings</div>
<div class="d" id="inspDesc">Select a cell.</div>
</div>
<div class="ctrlRow">
<button class="tiny secondary" id="inspClearBtn">Clear</button>
<button class="tiny secondary" id="inspPlayBtn">▶ Play</button>
<button class="tiny secondary" id="inspLoadBtn">Load</button>
<button class="tiny good" id="inspNormalizeBtn">Normalize</button>
<button class="tiny secondary" id="inspCopyToColBtn" title="Copy settings to all 8 cells in this column">Copy→Col</button>
<button class="tiny secondary" id="inspCopyToAllBtn" title="Copy settings to all 64 cells">Copy→All</button>
</div>
</div>
<div class="inspBody">
<div class="ctrl">
<div class="lbl"><span>Cell name</span><b> </b></div>
<input class="colTitleInput" id="cellName" placeholder="C1" style="max-width:100%;">
</input></div>
<div class="ctrl">
<div class="lbl"><span>Volume</span><b id="volVal">1.00×</b></div>
<input id="vol" max="2" min="0" step="0.01" type="range" value="1"/>
</div>
<div class="ctrl">
<div class="lbl"><span>Fade In (ms)</span><b id="fadeInVal">0</b></div>
<input id="fadeIn" max="1500" min="0" step="5" type="range" value="0"/>
</div>
<div class="ctrl">
<div class="lbl"><span>Fade Out (ms)</span><b id="fadeOutVal">0</b></div>
<input id="fadeOut" max="1500" min="0" step="5" type="range" value="0"/>
</div>
<div class="ctrl">
<div class="lbl"><span>Fit mode</span><b id="fitVal">rate</b></div>
<select id="fitMode">
<option value="rate">fit (rate/pitch)</option>
<option value="padtrim">pad/trim</option>
</select>
</div>
<div class="ctrl">
<div class="lbl"><span>Switches</span><b> </b></div>
<div class="ctrlRow" style="gap:14px;">
<label class="chk"><input id="mute" type="checkbox"/> Mute</label>
<label class="chk"><input id="reverse" type="checkbox"/> Reverse</label>
</div>
</div>
</div>
</div>
</div>
</main>
<!-- Random 64 Filter Overlay -->
<div aria-hidden="true" class="overlay" id="filterOverlay">
<div aria-label="Random 64 filters" aria-modal="true" class="helpPanel filterPanel" role="dialog">
<div class="helpHead">
<div class="helpTitle">Random 64 filters</div>
<button class="helpClose" id="filterOverlayClose" title="Close">✕</button>
</div>
<div class="helpBody" style="font-size:13px;">
<p class="muted" style="margin-top:0;">
          Use comma separated tokens. Matching is case-insensitive and checks the filename.
        </p>
<div class="helpGrid" style="margin-top:10px;">
<div class="helpCard">
<div class="helpCardTitle">Include</div>
<p class="muted">Only load files that contain <b>any</b> token below. Leave blank = include everything.</p>
<input id="filterIncludeInput" placeholder="e.g. kick,snare,hat" type="text">
</input></div>
<div class="helpCard">
<div class="helpCardTitle">Exclude</div>
<p class="muted">Skip files that contain <b>any</b> token below. Leave blank = exclude nothing.</p>
<input id="filterExcludeInput" placeholder="e.g. fx,loop" type="text">
</input></div>
</div>
<div class="helpCard" style="margin-top:10px;">
<div class="helpCardTitle">Tip</div>
<p class="muted" style="margin:0;">
            Example: include <span class="kbd">kick,snare,hat</span> and exclude <span class="kbd">fx,loop</span>.
          </p>
</div>
<div class="overlayActions helpActions" style="margin-top:12px;">
<button class="secondary" id="filterOverlayClearBtn" title="Clear both include and exclude filters">Clear</button>
<button class="secondary" id="filterOverlayCancelBtn">Cancel</button>
<button class="good" id="filterOverlaySaveBtn">Save</button>
</div>
</div>
</div>
</div>
<!-- /Random 64 Filter Overlay -->
<!-- Folder Picker Overlay (Preset Import) -->
<div aria-hidden="true" class="overlay" id="folderOverlay">
<div aria-label="Select sample folder" aria-modal="true" class="helpPanel folderPanel" role="dialog">
<div class="helpHead">
<div class="helpTitle">Select sample folder</div>
<button class="helpClose" id="folderOverlayClose" title="Close">✕</button>
</div>
<div class="helpBody">
<p class="muted" id="folderOverlayHint">
          Pick the top-level folder that contains your original samples (subfolders are included).
        </p>
<div class="helpCard" style="margin-top:10px;"><div class="overlayList" id="folderOverlayList"></div></div>
<div class="overlayActions helpActions">
<button class="good" id="folderOverlayPickBtn">Choose folder…</button>
<button class="secondary" id="folderOverlayCancelBtn">Cancel</button>
</div>
<p class="muted" style="margin-top:10px;">
          Tip: choose the folder that contains the files listed above. Keeping the same filenames (and ideally the same folder structure) makes relinking reliable.
        </p>
</div>
</div>
</div>
<!-- /Folder Picker Overlay -->
<!-- Preset Name Overlay (Export All ZIP) -->
<div aria-hidden="true" class="overlay" id="presetNameOverlay">
<div aria-label="Preset name" aria-modal="true" class="helpPanel folderPanel" role="dialog">
<div class="helpHead">
<div class="helpTitle">Export preset</div>
<button class="helpClose" id="presetNameOverlayClose" title="Close">✕</button>
</div>
<div class="helpBody">
<p class="muted">Preset name is used for the ZIP filename and the preset JSON filename. The preset JSON is named so it sorts after all samples when extracted.</p>
<div class="helpCard" style="margin-top:10px;">
<label class="muted" for="presetNameInput" style="display:block;margin-bottom:6px;">Preset name</label>
<input autocomplete="off" class="colNameInput" id="presetNameInput" spellcheck="false" type="text">
</input></div>
<div class="overlayActions helpActions" style="margin-top:12px;">
<button class="good" id="presetNameOkBtn">OK</button>
<button class="secondary" id="presetNameCancelBtn">Cancel</button>
</div>
</div>
</div>
</div>
<!-- /Preset Name Overlay -->
<div class="toast" id="toast"></div>
<!-- One hidden input for all loads -->
<input accept="audio/*" hidden="" id="fileInput" type="file">
<input accept="audio/*" hidden="" id="folderInput" multiple="" type="file" webkitdirectory="">
<!-- Help Overlay -->
<div aria-hidden="true" class="overlay" id="helpOverlay">
<div aria-label="Help" aria-modal="true" class="helpPanel" role="dialog">
<div class="helpHead">
<div class="helpTitle">Tempera Cell Matrix — Help</div>
<button class="helpClose" id="helpCloseBtn" title="Close">✕</button>
</div>
<div class="helpBody">
<div class="helpGrid">
<div class="helpCard">
<h3>Wave Editor</h3>
<p>Click the <b>waveform</b> in a cell to open the full source waveform and choose the exact slice for that cell.</p>
<ul class="helpList">
<li><b>Click</b> the mini-wave in a cell to open the full source waveform.</li>
<li><b>Drag</b> inside selection to move. Drag edges to resize.</li>
<li><b>L / M / R</b> — choose Left edge / Move / Right edge control (also affects arrow nudges).</li>
<li><b>Zoom window</b>: appears on dense waves (or when resizing). <b>+</b>/<b>-</b> zooms, <b>Z</b> toggles Auto‑Norm.</li>
<li><b>Esc</b>: if zoom window is visible → hide zoom. Otherwise → close editor.</li>
<li><b>← / →</b> nudge selection • <b>Shift</b>=coarse • <b>Alt/Option</b>=fine.</li>
<li><b>Trim</b> trims source to selection (Undo available). <b>Apply</b> commits selection to the cell (used for playback + export).</li>
</ul>
</div>
<div class="helpCard">
<h3>Basics</h3>
<p>8 columns × 8 rows. Columns are <b>Samples</b>. Rows are <b>Cells</b> (1..8).</p>
<ul class="helpList">
<li>Click a cell to select it (settings panel).</li>
<li><b>Double‑click</b> a cell or press <b>▶</b> to play.</li>
<li><b>Esc</b> stops playback. In editors: Esc hides the zoom window first, then closes the editor.</li>
<li><b>Tempo mode</b> uses BPM + Beats/cell and distributes rounding across 8 slices (no drift).</li>
<li>Drag cell→cell: swap. <b>Alt</b> + drag: copy.</li>
<li><b>Shift + click Random 64</b> to open the filter dialog:
                <ul>
<li><b>Include</b>: only filenames containing any token (comma separated)</li>
<li><b>Exclude</b>: skip filenames containing any token (comma separated)</li>
</ul>
                Example: include <span class="kbd">kick,snare,hat</span> and exclude <span class="kbd">fx,loop</span>.
              </li>
</ul>
</div>
<div class="helpCard">
<h3>Loading audio</h3>
<ul class="helpList">
<li><b>Cell Load</b>: click <b>Load</b> inside a cell or drop a file onto that cell.</li>
<li><b>Load+Slice</b>: pick one file → opens Slice Editor where you can drag/resize 8 blocks, then <b>Apply</b> to the column.</li>
<li><b>Load 8</b>: select 8 files → fills the 8 cells top→bottom.</li>
<li><b>Random 64</b>: pick a folder (subfolders included) → fills all cells randomly.</li>
</ul>
</div>
<div class="helpCard">
<h3>Editing</h3>
<ul class="helpList">
<li>Use the <b>Cell settings</b> panel to change Gain, Mute, Reverse, Fade In/Out and Fit mode.</li>
<li>Fades are drawn as an <b>envelope overlay</b> on top of the oscilloscope.</li>
<li>Gain is shown as a small bar under the oscilloscope (no text).</li>
</ul>
</div>
<div class="helpCard">
<h3>Import / Export</h3>
<p><b>Import Preset</b>: load the preset JSON exported by this app (e.g. <span class="kbd">zz_TCM-Preset_MyPreset_20260111.json</span>), then choose your top-level sample folder. Subfolders are included. The folder overlay shows example filenames to help you pick the right folder.</p>
<ul class="helpList">
<li><b>Export</b> in a column: exports that column to WAV.</li>
<li><b>Export 8</b> in a column: exports the 8 cells as separate WAV files (downloaded as one ZIP). Filenames use Sample + C#.</li>
<li><b>Export all (ZIP)</b>: exports up to 8 columns and downloads one ZIP file.</li>
<li>Empty columns are skipped.</li>
</ul>
</div>
<div class="helpCard helpCardRelease">
<h3>Release notes</h3>
<ul class="helpList" id="releaseNotes"></ul>
</div>
</div>
<div class="helpTip">
            Tip: If you don’t hear previews, click <b>Enable audio</b> (browser requirement).
          </div>
</div>
</div>
</div>


<!-- Wave Editor Overlay (v2.5.24 foundation) -->
<div aria-hidden="true" class="overlay" id="waveOverlay" style="display:none;">
<div class="helpPanel wavePanel">
<div class="helpHead">
<div class="helpTitle" id="waveTitle">Wave Editor<span class="z-indicator" id="zIndWave" title="Z: Auto-Norm">Z</span></div>
<div style="display:flex; gap:8px; align-items:center;">
<button class="helpClose" id="wavePlaySelBtn" title="Play current selection" type="button">Play sel</button>
<button class="helpClose" id="wavePlayFullBtn" title="Play full source" type="button">Play full</button>
<button class="helpClose" id="waveSnapBtn" title="Snap apply to zero-crossing" type="button">Snap: on</button>
<button class="helpClose" id="waveTrimBtn" title="Trim source to selection (undo available)" type="button">Trim</button>
<button class="helpClose" id="waveUndoBtn" title="Undo trim (Ctrl/Cmd+Z)" type="button">Undo</button>
<button class="helpClose" id="waveApplyBtn" title="Apply selection to the cell" type="button">Apply</button>
<button class="helpClose" id="waveResetBtn" title="Reset selection to full cell length" type="button">Reset</button>
<button class="helpClose" id="waveCloseBtn" title="Close" type="button">✕</button>
</div>
</div>
<div class="helpBody">
<div class="waveEditorWrap">
<div class="waveCanvasWrap">
<canvas class="waveBig" height="220" id="waveBig" width="900"></canvas>
<div class="waveScissorIcon" title="Trim selection">✂</div>
</div>
<div class="waveEditorMeta">
<div class="kv"><span class="k">Start</span><span class="v" id="waveSelStart">—</span></div>
<div class="kv"><span class="k">Length</span><span class="v" id="waveSelLen">—</span></div>
<div class="kv"><span class="k">Source</span><span class="v" id="waveSrcName">—</span></div>
</div>
<div class="waveEditorHint">
            Drag the selection window. Click inside to move; click outside jumps (zoom closes). Apply makes this selection the cell audio (used for playback + export). If the zoom window is visible: Z toggles Auto-Norm, +/- zooms, Esc (or clicking outside selection) hides it. Click outside the selection hides the zoom window.
          </div>
<div class="waveShortcuts">
<div class="waveShortcutsTitle">Shortcuts</div>
<ul class="waveShortcutsList">
<li><b>Space</b> — play selection</li>
<li><b>← / →</b> — nudge selection</li>
<li><b>L</b> / <b>M</b> / <b>R</b> — choose Left / Middle / Right control</li>
<li><b>Shift</b> + ← / → — coarse nudge</li>
<li><b>Alt/Option</b> + ← / → — fine nudge</li>
<li><b>+</b> / <b>-</b> — zoom window (when visible)</li>
<li><b>Z</b> — auto-normalize (when zoom window is visible)</li>
<li><b>Esc</b> — hide zoom (if visible) / close editor</li>
</ul>
<div class="waveShortcutsNote">Tip: <b>Snap</b> affects <b>Apply</b> (zero-crossing start).</div>
</div>
</div>
</div>
</div>
</div>
<!-- Column Split Editor Overlay -->
<div aria-hidden="true" class="overlay" id="splitOverlay" style="display:none;">
<div class="helpPanel wavePanel">
<div class="helpHead">
<div class="helpTitle" id="splitTitle">Slice Editor</div>
<div style="display:flex; gap:8px; align-items:center;">
<button class="helpClose" id="splitLoadBtn" title="Load a new sample for splitting" type="button">Load new</button>
<button class="helpClose" id="splitAutoBtn" title="Auto tile 8 slices across the sample" type="button">Auto</button>
<button class="helpClose" id="splitPlaySelBtn" title="Play focused slice (Space)" type="button">Play sel</button>
<button class="helpClose" id="splitPlayFullBtn" title="Play full sample" type="button">Play all</button>
<button class="helpClose" disabled="" id="splitUndoBtn" title="Undo last split edit" type="button">Undo</button>
<button class="helpClose" id="splitApplyBtn" title="Apply splits into the column" type="button">Apply</button>
<button class="helpClose" id="splitCloseBtn" style="margin-left:8px;" title="Close" type="button">Close</button>
</div>
</div>
<div class="helpBody" style="padding:10px 12px;">
<div class="waveWrap" id="splitBigWrap" style="position:relative;">
<canvas height="230" id="splitBig" style="width:100%; height:230px;" width="900"></canvas>
</div>
<div class="waveEditorMeta" style="margin-top:8px;">
<div class="kv"><span class="k">Name</span><span class="v" id="splitName">—</span></div>
<div class="kv"><span class="k">Start</span><span class="v" id="splitSelStart">—</span></div>
<div class="kv"><span class="k">Length</span><span class="v" id="splitSelLen">—</span></div>
<div class="kv"><span class="k">Source</span><span class="v" id="splitSrcName">—</span></div>
</div>
<div class="muted" id="splitHint" style="margin-top:8px; font-size:12px;">Load a sample, then drag/resize the 8 blocks.<br/><span class="muted"><b>Space</b>/<b>Play sel</b> = play/stop focused slice • <b>Play all</b> = play/stop full sample</span></div>
<div class="waveShortcuts">
<div class="waveShortcutsTitle">Shortcuts</div>
<ul class="waveShortcutsList">
<li><b>Space</b> — play focused slice</li>
<li><b>← / →</b> — nudge focused slice</li>
<li><b>Shift</b> + ← / → — coarse nudge</li>
<li><b>Alt/Option</b> + ← / → — fine nudge</li>
<li><b>L</b> / <b>M</b> / <b>R</b> — control Left edge / Move / Right edge (with zoom)</li>
<li><b>+</b> / <b>-</b> — zoom window (when visible)</li>
<li><b>Z</b> — auto-normalize (when zoom window is visible)</li>
<li><b>Esc</b> — hide zoom (if visible) / close editor</li>
</ul>
<div class="waveShortcutsNote">Tip: <b>Auto</b> spreads all 8 slices evenly across the whole sample.</div>
</div>
</div>
</div>
</div>
<!-- Magnifier (Phase 1: shows only while resizing handles in Wave/Split editors) -->
<div class="tcmMag" id="tcmMag" style="display:none">
<canvas height="200" id="tcmMagCv" width="420"></canvas>
<div class="tcmMagLbl" id="tcmMagLbl"><span id="tcmMagLblTxt"></span><span class="z-indicator" id="zIndMag" title="Z: Auto-Norm">Z</span></div>
</div>
</input></input></body>
</html>
